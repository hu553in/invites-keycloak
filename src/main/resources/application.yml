server:
  shutdown: graceful
  error:
    include-message: never
    include-binding-errors: never
    include-stacktrace: never

spring:
  mvc:
    problemdetails:
      enabled: true
    throw-exception-if-no-handler-found: true
  web:
    resources:
      add-mappings: false
  application:
    name: invites-keycloak
  lifecycle:
    timeout-per-shutdown-phase: 30s
  jpa:
    open-in-view: true
    hibernate:
      ddl-auto: validate
  datasource:
    url: jdbc:postgresql://${POSTGRES_HOSTNAME:db}:${POSTGRES_PORT:5432}/${POSTGRES_DB:invites-keycloak}
    username: ${POSTGRES_USER:invites-keycloak}
    password: ${POSTGRES_PASSWORD:invites-keycloak}
  security:
    oauth2:
      client:
        registration:
          keycloak:
            client-id: ${keycloak.client-id}
            client-secret: ${keycloak.client-secret}
            scope: openid, profile, email
        provider:
          keycloak:
            issuer-uri: ${keycloak.url}/realms/${keycloak.realm}

management:
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
        add-additional-paths: true
      group:
        liveness:
          include: livenessState
        readiness:
          include: readinessState,db
  health:
    diskspace:
      enabled: true

invite:
  expiry:
    default: 24h
    min: 5m
    max: 30d
  realms:
    master:
      default-roles:
        - default-admin-roles
  token:
    secret: ${INVITE_TOKEN_SECRET}
    bytes: 32
    salt-bytes: 16
    mac-algorithm: HmacSHA256

keycloak:
  url: ${KEYCLOAK_URL}
  realm: ${KEYCLOAK_REALM:master}
  client-id: ${KEYCLOAK_CLIENT_ID:invites-keycloak}
  client-secret: ${KEYCLOAK_CLIENT_SECRET}
  required-role: ${KEYCLOAK_REQUIRED_ROLE:invite-admin}
  max-attempts: 3
  min-backoff: PT2S

logging:
  structured:
    format:
      console: ecs
      file: ecs
    ecs:
      service:
        environment: ${SPRING_PROFILES_ACTIVE:prod}
